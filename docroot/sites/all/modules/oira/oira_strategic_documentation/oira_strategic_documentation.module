<?php
/**
 * @file
 * Code for the Strategic documentation feature.
 */

include_once 'oira_strategic_documentation.features.inc';

/**
 * Implements hook_block_info().
 */
function oira_strategic_documentation_block_info() {
  $blocks = array();
  $blocks['oira_strategic_docs_listing'] = array(
    'info' => t('Strategic documentation listing'),
    'status' => 1,
    'region' => '-1',
    'visibility' => BLOCK_VISIBILITY_NOTLISTED,
    'cache' => DRUPAL_NO_CACHE,
  );
  return $blocks;
}

/**
 * Implements hook_block_view().
 */
function oira_strategic_documentation_block_view($delta = '') {
  $block = array();
  if ($delta == 'oira_strategic_docs_listing') {
    module_load_include('inc', 'oira_strategic_documentation', 'oira_strategic_documentation.pages');
    $block['content'] = drupal_get_form('oira_strategic_documentation_menu_tools_form');
  }
  return $block;
}

/**
 * Implements hook_form_alter().
 */
function oira_strategic_documentation_form_alter(&$form, &$form_state, $form_id) {
  switch ($form_id) {
    case 'strategic_documentation_node_form':
      // Hide country - it's automatically added in oira_partner.module
      $form['field_country']['#access'] = FALSE;

      // TODO a validation server side.
//      $form['#validate'][] = 'oira_promotional_material_form_validate';

      $form['field_private_image']['#states'] = array(
        'required' => array(
          ':input[name="field_strategic_type[und]"]' => array('value' => 'photo'),
        ),
      );
      $form['field_private_file']['#states'] = array(
        'visible' => array(
          array(
            ':input[name*="field_strategic_type[und]"]' => array('value' => 'document'),
          ),
          array(
            ':input[name*="field_strategic_type[und]"]' => array('value' => 'visual'),
          ),
        ),
        'required' => array(
          array(
            ':input[name*="field_strategic_type[und]"]' => array('value' => 'document'),
          ),
          array(
            ':input[name*="field_strategic_type[und]"]' => array('value' => 'visual'),
          ),
        ),
      );
      $form['field_link']['#states'] = array(
        'visible' => array(
          ':input[name*="field_strategic_type[und]"]' => array('value' => 'link'),
        ),
        'required' => array(
          ':input[name*="field_strategic_type[und]"]' => array('value' => 'link'),
        ),
      );
      break;
  }
}
